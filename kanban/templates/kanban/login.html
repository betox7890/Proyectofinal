{% extends 'kanban/base.html' %}

{% block title %}Iniciar Sesión - Kanban Board{% endblock %}

{% block body_style %}background: #0f172a;{% endblock %}

{% block content %}
<div class="login-container">
    <div class="login-box">
        <h1>{% if requires_2fa %}Verificación en dos pasos{% else %}Iniciar Sesión{% endif %}</h1>
        {% if error_message %}
        <div class="error-message">{{ error_message }}</div>
        {% endif %}
        <form method="post" action="{% url 'kanban:login' %}">
            {% csrf_token %}
            {% if requires_2fa %}
            <input type="hidden" name="step" value="totp">
            <p class="info-text">Hola <strong>{{ username }}</strong>, ingresa el código de 6 dígitos generado por tu aplicación de autenticación.</p>
            <div class="form-group">
                <label for="code">Código 2FA:</label>
                <input type="text" id="code" name="code" inputmode="numeric" pattern="[0-9]{6}" maxlength="6" required autofocus>
            </div>
            <button type="submit" class="btn-login">Verificar</button>
            <div class="two-factor-help">
                <a class="two-factor-back" href="{% url 'kanban:login' %}">Iniciar sesión con otra cuenta</a>
            </div>
            {% else %}
            <input type="hidden" name="step" value="password">
            <div class="form-group">
                <label for="username">Nombre de usuario:</label>
                <input type="text" id="username" name="username" value="{{ username|default_if_none:'' }}" required autofocus>
            </div>
            <div class="form-group">
                <label for="password">Contraseña:</label>
                <input type="password" id="password" name="password" required>
            </div>
            <button type="submit" class="btn-login">Continuar</button>
            {% endif %}
        </form>
    </div>
</div>
{% endblock %}

